{"title": "Linq To CSV", "content": "<h2>LinqToCSV Class</h2>\n<pre> <code  data-enlighter-language=\"null\">namespace FooFoo\r\n{\r\n    public static class LinqToCSV\r\n    {\r\n        public static string ToCsv<T>(this IEnumerable<T> items)\r\n            where T : class\r\n        {\r\n            var csvBuilder = new StringBuilder();\r\n            var properties = typeof(T).GetProperties();\r\n            foreach (T item in items)\r\n            {\r\n                string line = string.Join(\",\",properties.Select(p => p.GetValue(item, null).ToCsvValue()).ToArray());\r\n                csvBuilder.AppendLine(line);\r\n            }\r\n            return csvBuilder.ToString();\r\n        }\r\n \r\n        private static string ToCsvValue<T>(this T item)\r\n        {\r\n            if(item == null) return \"\\\"\\\"\";\r\n \r\n            if (item is string)\r\n            {\r\n                return string.Format(\"\\\"{0}\\\"\", item.ToString().Replace(\"\\\"\", \"\\\\\\\"\"));\r\n            }\r\n            double dummy;\r\n            if (double.TryParse(item.ToString(), out dummy))\r\n            {\r\n                return string.Format(\"{0}\", item);\r\n            }\r\n            return string.Format(\"\\\"{0}\\\"\", item);\r\n        }\r\n    }\r\n}</code></pre>\n<h2>Example of usage:</h2>\n<pre> <code  data-enlighter-language=\"null\">public string Get()\r\n{\r\n    var db = new Db();\r\n    var data = db.Database.SqlQuery<SQLResult>(Query()).ToList();\r\n    var csv =  data.ToCsv();\r\n\r\n    var path = HttpContext.Current.Server.MapPath(@\"~/Content/data.csv\");\r\n\r\n    // Create a file to write to.\r\n    using (StreamWriter sw = File.CreateText(path))\r\n    {\r\n        sw.Write(csv);\r\n        sw.Flush();\r\n    }\r\n    return \"File Updated\";\r\n}</code></pre>\n<p> </p>\n<p>Source : <a href=\"https://www.hanselman.com/blog/BackToBasicsKeepItSimpleAndDevelopYourSenseOfSmellFromLinqToCSV.aspx\">https://www.hanselman.com/blog/BackToBasicsKeepItSimpleAndDevelopYourSenseOfSmellFromLinqToCSV.aspx</a></p>\n", "slug": "linq-to-csv", "featuredImage": null, "date": "2019-07-10T12:55:49", "categories": [".Net", "programming"]}